version: "3.7"

services:
  # Permet Ã  Umbrel d'afficher l'interface web sur le dashboard
  app_proxy:
    environment:
      APP_HOST: beammeup-frontend
      APP_PORT: 3000

  # API Backend (l'image que tu vas tagger 'joshuagessner/beammeup-backend')
  backend:
    image: joshuagessner/beammeup-backend:latest
    container_name: beammeup-backend
    restart: unless-stopped
    user: "0:0"
    environment:
      NODE_ENV: production
      FASTIFY_PORT: 3000
      SESSION_SECRET: ${SESSION_SECRET:-change-me-in-production-min-32-chars}
      DATABASE_URL: file:/app/data/beammeup.db
      BEAMMP_CONTAINER_NAME: beammp
      BEAMMP_CONFIG_PATH: /beammp-data/ServerConfig.toml
      BEAMMP_RESOURCES_PATH: /beammp-data/Resources
      MAX_MOD_SIZE: 2048
      DOCKER_HOST: unix:///var/run/docker.sock
    volumes:
      - ${APP_DATA_DIR}/data:/app/data
      - ${APP_DATA_DIR}/beammp-config:/beammp-data
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - beammeup

  # Interface Web (l'image que tu vas tagger 'joshuagessner/beammeup-frontend')
  frontend:
    image: joshuagessner/beammeup-frontend:latest
    container_name: beammeup-frontend
    restart: unless-stopped
    environment:
      NODE_ENV: production
    networks:
      - beammeup

  # Le serveur de jeu BeamMP (Image officielle, pas besoin de build)
  beammp:
    image: mbentley/beammp-server:latest
    container_name: beammp
    user: "0:0"
    restart: unless-stopped
    ports:
      - "30814:30814/tcp"
      - "30814:30814/udp"
    volumes:
      - ${APP_DATA_DIR}/beammp-config:/data
    depends_on:
      - backend
    networks:
      - beammeup

networks:
  beammeup:
    driver: bridge